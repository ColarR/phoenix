# Phoenix Client 2.0使用说明
## 环境说明
- 授予启动用户hdfs:///user 777的权限

## 安装部署
1. 打包项目
```shell script
cd phoenix-core
mvn install -DskipTests

cd phoenix-client
mvn install -DskipTests

cd phoenix-queryserver
mvn install -DskipTests
```

2. 替换原有queryserver的jar包和启动脚本
```shell script
cd phoenix-queryserver/target
scp phoenix-4.14.0-cdh5.13.2-queryserver.jar [Phoenix远程路径]

cd bin
scp queryserver.py [Phoenix远程路径]

cd bin
scp sqlline-thin.py [Phoenix远程路径]
```

3. 启动queryserver.py
```shell script
cd $PHOENIX_HOME/bin
./queryserver.py
```

4. 使用sqlline-thin.py连接queryserver
```shell script
cd $PHOENIX_HOME/bin
./sqlline-thin.py -u 用户名 -p 密码
```

## 配置说明
配置格式为：
- 环境变量：与配置名称一致
- hbase-site.xml：配置名称大小写均可，但是需要将下划线转为"."

| 配置                                         | 说明                                              |
| -------------------------------------------- | ------------------------------------------------- |
|HBASE_ZOOKEEPER_QUORUM|ZooKeeper IP地址|
|HBASE_ZOOKEEPER_PROPERTY_CLIENTPORT|ZooKeeper 端口地址|
|HBASE_SUPERUSER|HBase 超级用户名|
|PHOENIX_CLIENT_SSH_HOST|HBase 命令可执行节点IP地址|
|PHOENIX_CLIENT_SSH_PORT|HBase 命令可执行节点SSH端口|
|PHOENIX_CLIENT_SSH_USER|HBase 命令可执行节点用户名|
|PHOENIX_CLIENT_SSH_PASSWORD|HBase 命令可执行节点密码|
|PHOENIX_CLIENT_HBASE_SUPERUSER_PASSWORD|Phoenix 超级用户的密码，用户名对应HBASE_SUPERUSER|
|PHOENIX_CLIENT_ASYNC_INDEX_CORE_POOL_SIZE|创建异步索引线程池核心线程数量|
|PHOENIX_CLIENT_ASYNC_INDEX_MAXIMUM_POOL_SIZE|创建异步索引线程池最大线程数量|
|PHOENIX_CLIENT_ASYNC_INDEX_KEEP_ALIVE_TIME|创建异步索引线程池线程存活时间，单位毫秒|
|PHOENIX_CLIENT_ASYNC_INDEX_WORK_QUEUE|创建异步索引线程池线程队列数量|
|PHOENIX_CLIENT_ASYNC_INDEX_RETRY_NUM|异步索引重试次数|
|PHOENIX_CLIENT_QUERY_CACHE_HEAP_SIZE|查询缓存堆内存大小，单位Bytes|
|PHOENIX_CLIENT_QUERY_CACHE_IDLE_TIME|查询缓存失效时间（每次使用后时间刷新），单位毫秒|
|PHOENIX_CLIENT_TABLE_UPDATE_HEAP_SIZE|表更新时间堆内存大小，默认为100MB<br>注意：表更新时间缓存存储表名和时间戳，如果表名占用100字节，则1MB可以存储10000个表，因此不需要修改该配置|
|PHOENIX_CLIENT_TABLE_UPDATE_TIME_INTERVAL|表更新时间缓存写入SYSTEM.TABLE_UPDATE_TIME表的间隔，如果设置为0，则每次检测到表更新操作都会写入<br>注意：该值越大，意味着故障时丢失的数据越多<br>注意：该值越小，意味着越频繁地写入Phoenix表|
|PHOENIX_CLIENT_TABLE_UPDATE_TIME_CORE_POOL_SIZE|表更新时间缓存写入SYSTEM.TABLE_UPDATE_TIME表的线程数量<br>注意：只有当PHOENIX_CLIENT_TABLE_UPDATE_TIME_INTERVAL = 0时，该值才生效|
|PHOENIX_CLIENT_TABLE_UPDATE_TIME_MAXIMUM_POOL_SIZE|表更新时间缓存写入SYSTEM.TABLE_UPDATE_TIME表的最大线程数量|
|PHOENIX_CLIENT_TABLE_UPDATE_TIME_KEEP_ALIVE_TIME|表更新时间缓存写入SYSTEM.TABLE_UPDATE_TIME表的线程存活时间，单位毫秒|
|PHOENIX_CLIENT_TABLE_UPDATE_TIME_WORK_QUEUE|表更新时间缓存写入SYSTEM.TABLE_UPDATE_TIME表的线程队列大小|
|PHOENIX_CLIENT_AUDIT_ENABLE|数据库审计日志开启 注意：只有该值为true时，才会启用数据库审计日志|
|PHOENIX_CLIENT_AUDIT_PRE|数据库审计日志过滤前缀，设置为""代表所有操作都计入审计日志<br>注意：只有符合设置前缀的SQL语句才会被记录|
|PHOENIX_CLIENT_AUDIT_HEAP_SIZE|数据库审计日志缓存对大小，默认为1GB<br>注意：如果设置该值过小，会导致写入Phoenix表间隔期间可能会存在超出该设置的缓存，无法及时写入审计表中，导致审计日志丢失|
|PHOENIX_CLIENT_AUDIT_INTERVAL|数据库审计日志缓存写入SYSTEM.AUDIT表的间隔，如果设置为0，则每次检测到表更新操作都会写入<br>注意：该值越大，意味着故障时丢失的数据越多<br>注意：该值越小，意味着越频繁地写入Phoenix表<br>注意：如果该值设置过大，会导致写入Phoenix表间隔期间可能会存在超出缓存堆大小的缓存，无法及时写入审计表中，导致审计日志丢失|
|PHOENIX_CLIENT_AUDIT_CORE_POOL_SIZE|数据库审计日志缓存写入SYSTEM.AUDIT表的线程数量|
|PHOENIX_CLIENT_AUDIT_MAXIMUM_POOL_SIZE|数据库审计日志缓存写入SYSTEM.AUDIT表的最大线程数量|
|PHOENIX_CLIENT_AUDIT_KEEP_ALIVE_TIME|数据库审计日志缓存写入SYSTEM.AUDIT表的线程存活时间，单位毫秒|
|PHOENIX_CLIENT_AUDIT_TIME_WORK_QUEUE|数据库审计日志缓存写入SYSTEM.AUDIT表的线程队列大小|
|PHOENIX_CLIENT_ILLEGAL_THROW|查询时数据如果转换有异常，是否抛出<br>注意：该配置主要是为了映射HBase表，HBase原始数据与Phoenix不匹配时，Phoenix查询会直接抛出异常<br>注意：如果设置为false，则不会抛出异常，而是返回null|